<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­£åœ¨å‡†å¤‡åˆ†äº«...</title>
    <!-- å¼•å…¥å°çº¢ä¹¦å®˜æ–¹ JS SDK -->
    <script src="https://fe-static.xhscdn.com/biz-static/goten/xhs-1.0.1.js"></script>
    <style>
        /* ç®€å•çš„é¡µé¢æ ·å¼ï¼Œè®©æç¤ºä¿¡æ¯å±…ä¸­æ˜¾ç¤º */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            text-align: center; 
            padding-top: 50px; 
            color: #333;
        }
        #status {
            font-size: 1.2em;
            font-weight: bold;
        }
        #error {
            color: #d9534f; /* çº¢è‰²é”™è¯¯æç¤º */
            margin-top: 20px;
            word-break: break-all;
            padding: 0 20px;
        }
    </style>
</head>
<body>
    <h1 id="status">æ­£åœ¨ä»é£ä¹¦è·å–å†…å®¹å¹¶ç”Ÿæˆç­¾å...</h1>
    <p id="error"></p>

    <script>
        // ====================================================================================
        // â–¼â–¼â–¼ã€é‡è¦ã€‘è¯·å°†è¿™é‡Œçš„ URL æ›¿æ¢æˆä½ è‡ªå·±çš„è…¾è®¯äº‘å‡½æ•° URL (ä¸åŒ…å«æœ«å°¾çš„ /) â–¼â–¼â–¼
        // ====================================================================================
        const backendApiBaseUrl = 'https://1379932261-i6xdv0ilyt.ap-guangzhou.tencentscf.com';

        // é¡µé¢åŠ è½½åè‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰æ“ä½œ
        window.onload = async () => {
            const statusElement = document.getElementById('status');
            const errorElement = document.getElementById('error');

            try {
                // 1. ä»å½“å‰é¡µé¢çš„ URL ä¸­è·å– recordId (ä¾‹å¦‚ ?recordId=recABC123)
                const params = new URLSearchParams(window.location.search);
                const recordId = params.get('recordId');

                // å¦‚æœURLä¸­æ²¡æœ‰ recordIdï¼Œå°±æŠ¥é”™å¹¶åœæ­¢
                if (!recordId) {
                    throw new Error("é“¾æ¥æ— æ•ˆï¼šURLä¸­ç¼ºå°‘ recordId å‚æ•°ï¼è¯·æ£€æŸ¥é£ä¹¦è¡¨æ ¼çš„å…¬å¼æ˜¯å¦æ­£ç¡®ã€‚");
                }

                // 2. æ‹¼æ¥å®Œæ•´çš„åç«¯ API åœ°å€
                const fullApiUrl = `${backendApiBaseUrl}/get-share-data?recordId=${recordId}`;
                console.log("æ­£åœ¨è¯·æ±‚åç«¯åœ°å€:", fullApiUrl);

                // 3. å‘æˆ‘ä»¬çš„åç«¯æœåŠ¡è¯·æ±‚åˆ†äº«æ•°æ®
                const response = await fetch(fullApiUrl);
                const result = await response.json();

                // å¦‚æœåç«¯è¿”å›å¤±è´¥ä¿¡æ¯ï¼Œå°±æŠ¥é”™å¹¶åœæ­¢
                if (!result.success) {
                    throw new Error(result.message || "ä»åç«¯è·å–æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥äº‘å‡½æ•°æ—¥å¿—ã€‚");
                }

                console.log("æˆåŠŸè·å–åˆ†äº«æ•°æ®:", result.data);

                // 4. æˆåŠŸè·å–æ•°æ®ï¼Œç›´æ¥è°ƒç”¨å°çº¢ä¹¦åˆ†äº«
                statusElement.innerText = "æ•°æ®è·å–æˆåŠŸï¼Œæ­£åœ¨å”¤èµ·å°çº¢ä¹¦...ğŸš€";
                
                const { shareInfo, verifyConfig } = result.data;

                xhs.share({
                    shareInfo: shareInfo,
                    verifyConfig: verifyConfig,
                    fail: (e) => {
                        console.error('å°çº¢ä¹¦åˆ†äº«å¤±è´¥:', e);
                        statusElement.innerText = "åˆ†äº«å¤±è´¥";
                        // å°†é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜
                        errorElement.innerText = `è°ƒç”¨å°çº¢ä¹¦å®¢æˆ·ç«¯å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š${JSON.stringify(e)}`;
                    },
                });

            } catch (error) {
                console.error('æ•´ä¸ªæµç¨‹å‡ºé”™:', error);
                statusElement.innerText = "å‡ºé”™äº†ï¼";
                errorElement.innerText = error.message;
            }
        };
    </script>
</body>
</html>